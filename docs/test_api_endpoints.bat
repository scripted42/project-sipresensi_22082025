@echo off\r\nSETLOCAL ENABLEDELAYEDEXPANSION\r\n\r\necho ========================================\r\necho SiPresensi API Endpoint Testing Script\r\necho ========================================\r\necho.\r\n\r\nREM --- Konfigurasi ---\r\nset BASE_URL=http://127.0.0.1:8000\r\nset LOGIN_ENDPOINT=/api/auth/login\r\nset QR_TOKEN_ENDPOINT=/api/qrcode/dynamic\r\nset QR_VERIFY_ENDPOINT=/api/qrcode/verify\r\nset STUDENT_SCAN_ENDPOINT=/api/student-attendance/scan-qr\r\nset CLASS_STATUS_ENDPOINT=/api/student-attendance/class-status/1\r\n\r\nREM --- Data Dummy untuk Login (Ganti dengan kredensial yang valid di database Anda) ---\r\nset TEST_EMAIL=admin@example.com\r\nset TEST_PASSWORD=password123\r\n\r\necho [TEST 1/6] Attempting Login...\r\ncurl -s -X POST \"%BASE_URL%%LOGIN_ENDPOINT%\" ^\r\n  -H \"Content-Type: application/json\" ^\r\n  -d \"{\\\"email\\\": \\\"%TEST_EMAIL%\\\", \\\"password\\\": \\\"%TEST_PASSWORD%\\\"}\" > login_response.json\r\n\r\nREM --- Periksa apakah login berhasil ---\r\nfindstr /C:\"\\\"success\\\":true\" login_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] Login Successful\r\n    for /f \"delims=\" %%a in ('jq -r \".data.token\" login_response.json') do set ACCESS_TOKEN=%%a\r\n    echo Token: %ACCESS_TOKEN%\r\n    echo.\r\n) else (\r\n    echo [RESULT] Login Failed. Check credentials or server.\r\n    type login_response.json\r\n    echo.\r\n    goto :end_tests\r\n)\r\n\r\necho [TEST 2/6] Getting Dynamic QR Token...\r\ncurl -s -X GET \"%BASE_URL%%QR_TOKEN_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" > qr_token_response.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" qr_token_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] QR Token Retrieved Successfully\r\n    for /f \"delims=\" %%a in ('jq -r \".data.token\" qr_token_response.json') do set QR_TOKEN=%%a\r\n    echo Token: %QR_TOKEN%\r\n    echo.\r\n) else (\r\n    echo [RESULT] Failed to Get QR Token\r\n    type qr_token_response.json\r\n    echo.\r\n    goto :end_tests\r\n)\r\n\r\necho [TEST 3/6] Verifying QR Token for Checkin...\r\ncurl -s -X POST \"%BASE_URL%%QR_VERIFY_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" ^\r\n  -d \"{\\\"token\\\": \\\"%QR_TOKEN%\\\", \\\"type\\\": \\\"checkin\\\", \\\"latitude\\\": -6.200000, \\\"longitude\\\": 106.816666, \\\"accuracy\\\": 50}\" > qr_verify_checkin_response.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" qr_verify_checkin_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] QR Checkin Successful\r\n    echo.\r\n) else (\r\n    echo [RESULT] QR Checkin Failed\r\n    type qr_verify_checkin_response.json\r\n    echo.\r\n)\r\n\r\necho [TEST 4/6] Getting New Dynamic QR Token for Checkout...\r\ncurl -s -X GET \"%BASE_URL%%QR_TOKEN_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" > qr_token_response2.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" qr_token_response2.json >nul\r\nif %errorlevel% == 0 (\r\n    for /f \"delims=\" %%a in ('jq -r \".data.token\" qr_token_response2.json') do set QR_TOKEN2=%%a\r\n    echo [RESULT] New QR Token for Checkout Retrieved: %QR_TOKEN2%\r\n    echo.\r\n) else (\r\n    echo [RESULT] Failed to Get New QR Token for Checkout\r\n    type qr_token_response2.json\r\n    echo.\r\n    goto :end_tests\r\n)\r\n\r\necho [TEST 5/6] Verifying QR Token for Checkout...\r\ncurl -s -X POST \"%BASE_URL%%QR_VERIFY_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" ^\r\n  -d \"{\\\"token\\\": \\\"%QR_TOKEN2%\\\", \\\"type\\\": \\\"checkout\\\", \\\"latitude\\\": -6.200000, \\\"longitude\\\": 106.816666, \\\"accuracy\\\": 50}\" > qr_verify_checkout_response.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" qr_verify_checkout_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] QR Checkout Successful\r\n    echo.\r\n) else (\r\n    echo [RESULT] QR Checkout Failed\r\n    type qr_verify_checkout_response.json\r\n    echo.\r\n)\r\n\r\necho [TEST 6/6] Scanning Student QR Code...\r\ncurl -s -X POST \"%BASE_URL%%STUDENT_SCAN_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" ^\r\n  -d \"{\\\"qr_code\\\": \\\"STUDENT_QR_CODE_123\\\", \\\"latitude\\\": -6.200000, \\\"longitude\\\": 106.816666, \\\"accuracy\\\": 50}\" > student_scan_response.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" student_scan_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] Student QR Scan Successful\r\n    echo.\r\n) else (\r\n    echo [RESULT] Student QR Scan Failed\r\n    type student_scan_response.json\r\n    echo.\r\n)\r\n\r\necho [TEST 7/7] Getting Class Attendance Status...\r\ncurl -s -X GET \"%BASE_URL%%CLASS_STATUS_ENDPOINT%\" ^\r\n  -H \"Authorization: Bearer %ACCESS_TOKEN%\" ^\r\n  -H \"Content-Type: application/json\" > class_status_response.json\r\n\r\nfindstr /C:\"\\\"success\\\":true\" class_status_response.json >nul\r\nif %errorlevel% == 0 (\r\n    echo [RESULT] Class Status Retrieved Successfully\r\n    echo.\r\n) else (\r\n    echo [RESULT] Failed to Get Class Status\r\n    type class_status_response.json\r\n    echo.\r\n)\r\n\r\necho ========================================\r\necho All tests completed. Check individual response files for details:\r\necho - login_response.json\r\necho - qr_token_response.json\r\necho - qr_verify_checkin_response.json\r\necho - qr_token_response2.json\r\necho - qr_verify_checkout_response.json\r\necho - student_scan_response.json\r\necho - class_status_response.json\r\necho ========================================\r\n\r\n:end_tests\r\necho Test script finished.\r\nendlocal