===============================================================================
                    SIPRESENSI - PRODUCT REQUIREMENTS DOCUMENT
             (PRD) & SYSTEM ARCHITECTURE (Lengkap dalam 1 File)
-------------------------------------------------------------------------------
Nama Aplikasi       : Sipresensi (Sistem Presensi Digital Sekolah)
Versi               : 1.0
Tanggal             : 5 April 2025
Tech Stack          : Flutter (Dart) + Laravel + MySQL (XAMPP)
Target Platform     : Android & iOS
Tujuan              : Aplikasi absensi digital sekolah dengan verifikasi 
                      lokasi, foto selfie, dan QR Code dinamis.
===============================================================================


1. GAMBARAN UMUM
---------------
Sipresensi adalah aplikasi mobile untuk manajemen absensi digital di lingkungan 
sekolah, dibangun menggunakan Flutter untuk performa tinggi dan UI konsisten 
di Android & iOS. Dirancang untuk siswa, guru, pegawai, kepala sekolah, dan admin, 
dengan fitur keamanan tinggi seperti:

- Verifikasi lokasi GPS (radius 100m dari sekolah)
- Foto selfie langsung dari kamera perangkat
- Pemindaian QR Code dinamis (berubah tiap 10 detik)
- Mode offline untuk fleksibilitas

Aplikasi ini menggunakan:
- Frontend: Flutter (Dart) + Riverpod + GoRouter
- Backend: Laravel (PHP) sebagai REST API
- Database: MySQL (via XAMPP)
- Hosting: Lokal (PC/server sekolah), bisa diakses via jaringan internal/eksternal


2. TUJUAN APLIKASI
------------------
- Menggantikan sistem absensi manual (buku daftar hadir).
- Meningkatkan akurasi absensi dengan verifikasi ganda/triple (lokasi + QR + selfie).
- Mencegah kecurangan absensi (tidak hadir fisik).
- Mempermudah pengajuan izin digital dengan lampiran (PDF/gambar).
- Memberikan dashboard real-time untuk monitoring oleh kepala sekolah & admin.
- Mendukung mode offline untuk fleksibilitas.
- Menyediakan navigasi modern dengan FAB scan di tengah bottom bar.


3. TARGET PENGGUNA & PERAN
--------------------------
| Peran               | Jumlah | Hak Akses Utama |
|---------------------|--------|-----------------|
| Siswa               | ~1000  | Absensi (via guru), lihat riwayat, ajukan izin |
| Guru                | ~50    | Absensi pribadi, isi absensi siswa, scan QR |
| Pegawai Sekolah     | ~20    | Absensi pribadi, ajukan izin |
| Kepala Sekolah      | 1      | Pantau semua data, setujui izin, buat/pengumuman |
| Admin               | ~3     | Kelola pengguna, sistem, dan hak akses |


4. FITUR INTI APLIKASI (FLUTTER)
--------------------------------

4.1. Autentikasi & Otorisasi
- Login Multi-Peran: Gunakan NISN (siswa), NIP (guru), atau NIK (pegawai) sebagai username.
- JWT Token: Autentikasi aman dengan token dan refresh token.
- Auto-Logout: Setelah 15 menit tidak aktif (di AppState).
- Enkripsi Password: Di backend menggunakan bcrypt.
- Secure Storage: Simpan token dengan flutter_secure_storage.

4.2. Dashboard Berbasis Peran
- Siswa/Staff: Riwayat absensi, izin mendatang, pengumuman.
- Guru: Ringkasan absensi kelas, aktivitas terbaru.
- Kepala Sekolah/Admin: Statistik global, izin menunggu, pengumuman terbaru.
- Slider Tanggal: Geser horizontal (PageView atau Horizontal ListView).
- Activity Feed: Update real-time (polling API).
- Carousel Pengumuman: Otomatis bergulir (carousel_slider).

4.3. Sistem Absensi (Guru, Pegawai, Kepala Sekolah)
Untuk absen, pengguna harus memenuhi 3 syarat:
1. Verifikasi Lokasi (GPS): Harus berada dalam radius 100 meter dari sekolah.
2. Foto Selfie: Ambil foto langsung dari kamera perangkat.
3. Scan QR Code Dinamis: Pindai QR yang ditampilkan di monitor sekolah dan berganti tiap 10 detik.

4.4. Absensi Siswa (oleh Guru/Pegawai)
- Guru scan QR Code statis di kartu pelajar siswa.
- Bisa dilakukan secara massal (per kelas).
- Opsi input manual jika QR rusak (input NISN/NIP).
- Simpan sementara di lokal (offline) → sinkron ke server saat online.

4.5. Manajemen Izin
- Ajukan Izin: Jenis (izin, cuti, dinas luar, sakit).
- Editor teks kaya: Gunakan flutter_quill atau TextFormField.
- Lampiran file: Unggah surat dokter (PDF/gambar) — file_picker.
- Pemilih tanggal: Kalender bawaan (showDatePicker).
- Hitung otomatis: Sisa kuota izin (ambil dari API).
- Riwayat Izin: Lihat status (menunggu, disetujui, ditolak).
- Persetujuan (Kepala Sekolah/Admin): Setujui/tolak + komentar.

4.6. Pengumuman (Kepala Sekolah/Admin)
- Buat Pengumuman: Form dengan judul dan isi.
- Daftar Pengumuman: Tampilkan terbaru dulu (ListView.builder).
- Edit/Hapus: Hanya oleh pembuat atau admin.

4.7. Manajemen Profil
- Lihat Profil: Nama, email, nomor telepon, peran, foto.
- Edit Profil: Ubah data kecuali peran.
- Ganti Password: Validasi password lama, enkripsi baru (di backend).

4.8. Manajemen Pengguna (Admin)
- Daftar Pengguna: Tampilkan semua dengan filter peran (DropdownButton).
- Tambah Pengguna: Isi form (NIK, nama, email, peran).
- Edit/Hapus Pengguna: Ubah atau nonaktifkan akun.

4.9. Tab Navigation dengan Animasi & FAB Scan
- Tab Bar di bagian bawah (Bottom Tab Navigator).
- 5 Tab: Dashboard, Absensi, [FAB], Izin, Profil.
- FAB (Floating Action Button): Tombol besar di tengah untuk melakukan absensi.
- Animasi saat berpindah tab:
   - Transisi slide horizontal (PageTransition).
   - Efek scale kecil saat tab aktif.
   - Warna ikon dan teks berubah halus (AnimatedContainer).
- Desain modern dengan Material 3 + Google Fonts + warna utama #007b5e.


5. SYSTEM ARCHITECTURE
----------------------

Diagram Arsitektur:

                   +---------------------+
                   |   Perangkat Mobile  |
                   |   [Flutter App]     |
                   | (Dart + Material 3) |
                   +----------+----------+
                              |
                    HTTP/HTTPS (REST API)
                              |
                   +----------v----------+
                   |  PC/Laptop Server   |
                   |                     |
                   | +-----------------+ |
                   | |   Laravel API   | |
                   | | (Backend PHP)   | |
                   +--------+--------+ |
                   |          |          |
                   | +--------v--------+ |
                   | |  MySQL Database | |
                   | |  (via XAMPP)    | |
                   +-----------------+ |
                   +---------------------+


5.1. Aplikasi Mobile (Client - Flutter)
- Teknologi: Flutter (Dart) + Riverpod + GoRouter
- UI Framework: Material 3 + Custom Widget
- Library Pendukung:
   - dio (HTTP client)
   - flutter_riverpod (state management)
   - geolocator (GPS)
   - camera (foto selfie)
   - mobile_scanner (scan QR)
   - file_picker (unggah lampiran)
   - table_calendar (kalender)
   - shared_preferences & flutter_secure_storage (simpan token)
   - go_router (navigasi)
   - google_fonts & flutter_svg (desain)
- Tanggung Jawab:
   - Menampilkan UI modern dengan animasi tab & FAB.
   - Mengelola navigasi antar layar.
   - Mengirim data ke backend Laravel via REST API.
   - Menyimpan data lokal untuk mode offline.
   - Mengakses fitur perangkat: kamera, GPS, penyimpanan.
   - Menangani autentikasi (JWT) dan sesi.


5.2. Backend Server (API)
- Teknologi: Laravel (PHP)
- Framework: Laravel 10+ (REST API only)
- Library Pendukung:
   - Laravel Sanctum (autentikasi API)
   - Intervention Image (resize foto selfie)
   - Flysystem (upload file)
   - Carbon (manajemen tanggal)
- Tanggung Jawab:
   - Menyediakan endpoint REST API:
      - /api/auth/login
      - /api/attendance/checkin
      - /api/attendance/scan-qr
      - /api/attendance/history
      - /api/leaves
      - /api/announcements
      - /api/users
   - Memproses logika bisnis (validasi lokasi, cek kuota izin, dll).
   - Validasi dan sanitasi input (XSS, SQL Injection).
   - Berinteraksi dengan database MySQL.
   - Mengembalikan respons JSON.
   - Mendukung mode stateless (JWT).


5.3. Database (MySQL via XAMPP)
- Teknologi: MySQL
- Manajemen: XAMPP (Apache + MySQL + phpMyAdmin)
- Lokasi: Diinstal pada PC/laptop yang sama dengan server Laravel
- Tabel Utama:
   - users
   - attendance
   - leaves
   - announcements
   - dynamic_qr_tokens
   - roles
   - classes

Tabel: dynamic_qr_tokens
| Kolom       | Tipe Data     | Deskripsi |
|-------------|---------------|-----------|
| id          | BIGINT (PK)   | ID unik |
| token       | VARCHAR(255)  | Token acak (a1b2c3d4e5f6) |
| created_at  | DATETIME      | Waktu pembuatan |
| expires_at  | DATETIME      | created_at + 10 detik |
| used        | BOOLEAN       | Sudah digunakan? |
| used_by     | BIGINT        | user_id yang menggunakannya |


6. MEKANISME QR CODE DINAMIS
----------------------------
- Ditampilkan di monitor sekolah (depan ruang guru/gerbang).
- Web client (HTML + JS) panggil GET /api/qrcode/dynamic tiap 10 detik.
- Laravel generate token unik, simpan di cache (Redis/file) selama 10 detik.
- Aplikasi mobile scan QR → kirim token ke backend → dicek valid & belum digunakan.
- Jika valid + lokasi + foto OK → absensi berhasil.
- Token ditandai "used" agar tidak bisa dipakai lagi.

Keamanan: Mencegah rekam layar, foto QR, atau absen dari jarak jauh.


7. ALUR DATA (Contoh: Check-in)
-------------------------------
1. Pengguna buka aplikasi → login.
2. Tekan "Check-in" di dashboard.
3. Aplikasi ambil lokasi GPS → cek dalam radius 100m.
4. Buka kamera → scan QR dinamis di monitor.
5. Ambil foto selfie.
6. Kirim ke Laravel: lokasi, foto, token QR, timestamp.
7. Laravel verifikasi:
   - Token valid & belum kadaluarsa
   - Lokasi dalam radius
   - Belum absen hari ini
8. Jika valid → simpan ke database → kirim respons sukses.
9. Aplikasi tampilkan: "Absensi berhasil!"


8. PERTIMBANGAN JARINGAN
------------------------
- Pengembangan: 
   - Backend: http://192.168.1.10:8000
   - Aplikasi: Gunakan IP lokal
- Produksi:
   - Gunakan DDNS (misal: mikrotik.com)
   - Port forwarding: port publik 8000 → IP lokal:8000
   - URL: http://sipresensi.cloud.mikrotik.com:8000


9. KEAMANAN
-----------
- HTTPS di produksi (SSL/TLS)
- JWT dengan refresh token
- Validasi input di backend
- Firewall: Batasi akses ke port 8000 & 3306
- Backup database harian
- Rate limiting untuk cegah brute force
- Sanitasi input (XSS, SQL Injection)


10. ALUR PENGEMBANGAN
---------------------
1. Setup: Flutter SDK, Android Studio, PHP, Composer, XAMPP
2. Database: Buat skema di phpMyAdmin
3. Backend: Laravel (API + Sanctum + QR generator)
4. Frontend: Flutter + Riverpod + mobile_scanner + FAB scan
5. Testing: Postman, HP fisik
6. Deploy: Jalankan Laravel, aktifkan XAMPP, konfigurasi jaringan
7. Build: APK (Android) atau App Store (iOS)


11. SKALABILITAS MASA DEPAN
---------------------------
- Migrasi database ke cloud (AWS RDS)
- Containerisasi backend (Docker)
- Load balancing untuk traffic tinggi
- Real-time notifikasi (Laravel Echo + WebSocket)
- Flutter Web: Dashboard admin via browser
- Admin Panel: Laravel + Livewire/Inertia


12. REKOMENDASI PACKAGE FLUTTER
-------------------------------
| Fungsi                     | Package |
|----------------------------|---------|
| State Management           | flutter_riverpod |
| Navigasi                   | go_router |
| HTTP Client                | dio |
| QR Scanner                 | mobile_scanner |
| Kamera                     | camera |
| GPS                        | geolocator |
| File Picker                | file_picker |
| Kalender                   | table_calendar |
| Animasi                    | animations |
| Carousel                   | carousel_slider |
| Rich Text                  | flutter_quill |
| Offline Check              | flutter_offline |
| Local Storage              | shared_preferences, hive |
| Keamanan                   | flutter_secure_storage |
| Desain                     | google_fonts, flutter_svg |


13. STRUKTUR FOLDER (Flutter)
----------------------------
lib/
 ├─ main.dart
 ├─ core/
 │   ├─ theme/app_theme.dart
 │   ├─ routing/app_router.dart
 │   ├─ network/dio_client.dart
 │   ├─ storage/secure_store.dart
 │   └─ utils/date_utils.dart
 ├─ features/
 │   ├─ dashboard/presentation/dashboard_screen.dart
 │   ├─ attendance/
 │   │   ├─ presentation/attendance_screen.dart
 │   │   └─ data/attendance_api.dart
 │   ├─ scanner/presentation/scanner_screen.dart
 │   ├─ leave/presentation/leave_screen.dart
 │   └─ profile/presentation/profile_screen.dart
 └─ shared/
     ├─ widgets/fab_scan.dart
     └─ widgets/app_bottom_bar.dart


14. DESAIN & WARNA
------------------
- Primary Color: #007b5e
- Secondary: #0aa37d
- Background: #F7F9FB
- Text: #1F2937
- Font: Google Fonts (Inter)
- Ikon: Material Icons


===============================================================================
                             AKHIR DOKUMEN
                             SiPresensi - Flutter Edition
===============================================================================